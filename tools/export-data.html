<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marketing Team AI - ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</title>
<style>
  * { box-sizing: border-box; margin: 0; }
  body {
    min-height: 100vh;
    background: #0A0E1A;
    color: #F1F5F9;
    font-family: 'Noto Sans JP', -apple-system, sans-serif;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }
  .container {
    max-width: 600px;
    width: 100%;
    background: #111827;
    border: 1px solid #1E293B;
    border-radius: 12px;
    padding: 32px;
  }
  h1 { font-size: 20px; margin-bottom: 8px; }
  .desc { font-size: 13px; color: #94A3B8; line-height: 1.7; margin-bottom: 24px; }
  .steps { margin-bottom: 24px; }
  .step {
    display: flex; gap: 12px; padding: 12px 0;
    border-bottom: 1px solid #1E293B;
  }
  .step-num {
    width: 28px; height: 28px; border-radius: 50%;
    background: #3B82F622; border: 2px solid #3B82F6;
    display: flex; align-items: center; justify-content: center;
    font-size: 13px; font-weight: 700; color: #3B82F6; flex-shrink: 0;
  }
  .step-text { font-size: 13px; color: #94A3B8; line-height: 1.7; }
  .step-text strong { color: #F1F5F9; }
  button {
    background: #3B82F6; color: #fff; border: none;
    padding: 12px 24px; border-radius: 8px;
    font-size: 14px; font-weight: 600; cursor: pointer;
    font-family: inherit; width: 100%;
    transition: opacity 0.2s;
  }
  button:hover { opacity: 0.9; }
  button:disabled { opacity: 0.4; cursor: not-allowed; }
  .result {
    margin-top: 16px; padding: 16px;
    border-radius: 8px; font-size: 13px; line-height: 1.7;
  }
  .result.success { background: #10B98122; border: 1px solid #10B98144; color: #10B981; }
  .result.error { background: #EF444422; border: 1px solid #EF444444; color: #EF4444; }
  .result.info { background: #3B82F622; border: 1px solid #3B82F644; color: #94A3B8; }
  .stats { margin-top: 12px; font-size: 12px; color: #64748B; }
  .stats div { padding: 2px 0; }
  .stats span { color: #F1F5F9; font-weight: 600; }
  code {
    background: #0D1220; padding: 2px 6px; border-radius: 4px;
    font-size: 12px; color: #22D3EE;
  }
  .warning {
    margin-top: 16px; padding: 12px;
    background: #F59E0B11; border: 1px solid #F59E0B33;
    border-radius: 8px; font-size: 12px; color: #F59E0B; line-height: 1.6;
  }
</style>
</head>
<body>
<div class="container">
  <h1>ğŸ“¦ ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</h1>
  <p class="desc">
    æ—§ã‚¢ãƒ—ãƒªï¼ˆClaude Artifactï¼‰ã® <code>window.storage</code> ã‹ã‚‰å…¨ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å‡ºã—ã€
    JSONãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚
  </p>

  <div class="steps">
    <div class="step">
      <div class="step-num">1</div>
      <div class="step-text">
        <strong>æ—§ã‚¢ãƒ—ãƒªã®Artifactå†…</strong>ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®DevToolsï¼ˆF12ï¼‰ã‚’é–‹ã
      </div>
    </div>
    <div class="step">
      <div class="step-num">2</div>
      <div class="step-text">
        Consoleã‚¿ãƒ–ã« <strong>ä¸‹è¨˜ã‚¹ã‚¯ãƒªãƒ—ãƒˆ</strong> ã‚’è²¼ã‚Šä»˜ã‘ã¦å®Ÿè¡Œ
      </div>
    </div>
    <div class="step">
      <div class="step-num">3</div>
      <div class="step-text">
        JSONãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã®ã§ã€<strong>æ–°ã‚¢ãƒ—ãƒªã®è¨­å®šç”»é¢</strong>ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
      </div>
    </div>
  </div>

  <div class="warning">
    âš ï¸ ã“ã®HTMLãƒ•ã‚¡ã‚¤ãƒ«ã¯Artifactå¤–ãªã®ã§ <code>window.storage</code> ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã€‚<br>
    ä¸‹ã®ã€Œã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã€ãƒœã‚¿ãƒ³ã§ã‚³ãƒ”ãƒ¼ã—ã€<strong>æ—§ã‚¢ãƒ—ãƒªã®Artifactç”»é¢ã®DevTools Console</strong>ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚
  </div>

  <button id="copyBtn" style="margin-top: 16px;">ğŸ“‹ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼</button>

  <div id="result"></div>
</div>

<script>
// ====================================
// ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆæœ¬ä½“
// æ—§ã‚¢ãƒ—ãƒªã®DevTools Consoleã«è²¼ã‚Šä»˜ã‘ã¦å®Ÿè¡Œ
// ====================================
const EXPORT_SCRIPT = `
(async function() {
  // èª­ã¿å–ã‚Šå¯¾è±¡ã‚­ãƒ¼ï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³é•ã„ã‚‚å«ã‚ã¦å…¨ã¦è©¦ã™ï¼‰
  const KEY_MAP = {
    agents: [
      "mkt-team:agents-v3",
      "mkt-team:agents-v2",
      "mkt-team:agents",
    ],
    knowledge: [
      "mkt-team:knowledge-v4",
      "mkt-team:knowledge-v3",
      "mkt-team:knowledge",
      "ai-emp:knowledge-v1",
    ],
    feedbacks: [
      "mkt-team:fb-v1",
      "mkt-team:feedbacks-v1",
      "mkt-team:feedbacks",
      "ai-emp:feedbacks-v2",
    ],
    tasks: [
      "mkt-team:tasks-v1",
      "mkt-team:tasks",
    ],
    reports: [
      "mkt-team:reports",
    ],
    clients: [
      "mkt-team:clients",
    ],
    projects: [
      "mkt-team:projects",
    ],
    templates: [
      "mkt-team:templates",
    ],
    recurring: [
      "mkt-team:recurring",
    ],
    archivedTasks: [
      "mkt-team:archived-tasks",
    ],
    history: [
      "mkt-team:history-v1",
      "mkt-team:history",
    ],
  };

  async function tryRead(key) {
    try {
      var r = await window.storage.get(key);
      if (r && r.value) return JSON.parse(r.value);
    } catch(e) {}
    return null;
  }

  // å„ã‚«ãƒ†ã‚´ãƒªã§æœ€åˆã«ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã£ãŸã‚­ãƒ¼ã‚’æ¡ç”¨
  async function readFirst(keys) {
    for (var i = 0; i < keys.length; i++) {
      var data = await tryRead(keys[i]);
      if (data !== null && data !== undefined) {
        // é…åˆ—ã®å ´åˆã¯ä¸­èº«ãŒã‚ã‚‹ã‚‚ã®ã‚’å„ªå…ˆ
        if (Array.isArray(data) && data.length > 0) return { data: data, key: keys[i] };
        // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å ´åˆã¯ã‚­ãƒ¼ãŒã‚ã‚‹ã‚‚ã®ã‚’å„ªå…ˆ
        if (typeof data === "object" && !Array.isArray(data) && Object.keys(data).length > 0) return { data: data, key: keys[i] };
        // ç©ºã§ã‚‚ä¸€å¿œè¨˜éŒ²ï¼ˆå¾Œç¶šã§è¦‹ã¤ã‹ã‚‰ãªã‘ã‚Œã°ã“ã‚Œã‚’ä½¿ã†ï¼‰
        if (!firstEmpty) var firstEmpty = { data: data, key: keys[i] };
      }
    }
    return firstEmpty || null;
  }

  var exportData = { version: "1.0", exportedAt: new Date().toISOString(), source: "claude-artifact", data: {} };
  var stats = {};

  for (var category in KEY_MAP) {
    var result = await readFirst(KEY_MAP[category]);
    if (result) {
      exportData.data[category] = result.data;
      var count = Array.isArray(result.data)
        ? result.data.length
        : typeof result.data === "object"
          ? Object.keys(result.data).length
          : 1;
      stats[category] = { count: count, sourceKey: result.key };
    }
  }

  // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
  var json = JSON.stringify(exportData, null, 2);
  var blob = new Blob([json], { type: "application/json" });
  var url = URL.createObjectURL(blob);
  var a = document.createElement("a");
  a.href = url;
  a.download = "marketing-team-export-" + new Date().toISOString().slice(0,10) + ".json";
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);

  // çµæœè¡¨ç¤º
  console.log("=== Marketing Team AI Export ===");
  console.log("Exported at:", exportData.exportedAt);
  for (var cat in stats) {
    console.log(cat + ": " + stats[cat].count + " items (from " + stats[cat].sourceKey + ")");
  }
  console.log("File size:", (json.length / 1024).toFixed(1) + " KB");
  console.log("================================");
  console.log("âœ… ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆå®Œäº†ï¼ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸJSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ–°ã‚¢ãƒ—ãƒªã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ãã ã•ã„ã€‚");
})();
`.trim();

document.getElementById("copyBtn").addEventListener("click", async function() {
  try {
    await navigator.clipboard.writeText(EXPORT_SCRIPT);
    var resultEl = document.getElementById("result");
    resultEl.className = "result success";
    resultEl.innerHTML = "âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼<br><br>æ—§ã‚¢ãƒ—ãƒªã® Artifact ç”»é¢ã§ DevTools Console ã‚’é–‹ãã€è²¼ã‚Šä»˜ã‘ã¦å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚";
    this.textContent = "âœ… ã‚³ãƒ”ãƒ¼æ¸ˆã¿";
    setTimeout(function() {
      document.getElementById("copyBtn").textContent = "ğŸ“‹ ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼";
    }, 3000);
  } catch(e) {
    var resultEl = document.getElementById("result");
    resultEl.className = "result error";
    resultEl.textContent = "ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ: " + e.message;
  }
});
</script>
</body>
</html>
